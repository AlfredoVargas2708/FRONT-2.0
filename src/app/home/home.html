<div class="lego-pieces-container container-fluid">
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h1 class="mb-3">Piezas de Lego</h1>
            <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addModal">Agregar Nueva
                Pieza</button>
        </div>
    </div>

    <div class="row mb-4 justify-content-center">
        <div class="col-md-3 mb-2">
            <select class="form-select" (change)="onSearchByChange($event)">
                <option value="" disabled selected>Seleccionar...</option>
                <option *ngFor="let option of options" [value]="option">{{ option }}</option>
            </select>
        </div>
        <div class="col-md-5 mb-2">
            <div class="search-by-container">
                <input #searchByInput type="text" class="form-control search-by" placeholder="Buscar..."
                    (input)="onSearchResult($event)" />
                <img src="https://img.icons8.com/ios/50/cancel.png" alt="cancel" (click)="onClearSearch()"
                    class="cancel-icon" />
            </div>
        </div>
    </div>

    <div class="row mb-4 justify-content-center" *ngIf="showResults">
        <div class="col-md-6 search-results">
            <ul>
                <li *ngFor="let result of searchResults" (click)="onSelectOption(result)">
                    {{ result }}
                </li>
            </ul>
        </div>
    </div>

    <div class="row">
        <div class="col-12 lego-table">
            <table class="table table-striped table-hover" *ngIf="showTable">
                <thead class="table-dark text-center">
                    <tr>
                        <th *ngFor="let header of tableHeaders">{{ header }}</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let lego of legoResults">
                        <ng-container *ngFor="let body of tableBody">
                            <td *ngIf="body.type === 'image'" class="text-center image-cell">
                                <img [src]="lego[body.name]"
                                    [alt]="body.name === 'imagePiece' ? 'Imagen de la Pieza' : 'Imagen del Set'"
                                    [ngClass]="body.name === 'imagePiece' ? 'image-piece-class' : 'set-image-class'" />
                            </td>
                            <td *ngIf="body.type === 'text' || body.type === 'number'" class="text-center">
                                {{ lego[body.name] }}
                            </td>
                            <td *ngIf="body.type === 'actions'" class="text-center">
                                <div class="d-flex flex-column gap-2">
                                    <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal"
                                        data-bs-target="#editModal" (click)="onEditLego(lego)">Editar</button>
                                    <button class="btn btn-sm btn-outline-danger"
                                        (click)="deleteLego(lego.id)">Eliminar</button>
                                </div>
                            </td>
                        </ng-container>
                    </tr>
                </tbody>
            </table>
            <div class="text-center" *ngIf="isLoading">
                <div class="spinner-border text-primary" role="status"><span class="visually-hidden">Cargando...</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- EDIT MODAL -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="editModalLabel">‚úèÔ∏è Editar Pieza de LEGO</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <form [formGroup]="editForm" class="row row-cols-1 row-cols-md-2 g-3">
                    <div class="col" *ngFor="let field of formFields">
                        <label [for]="field.name" class="form-label">{{ field.label }}</label>
                        <input *ngIf="field.type === 'text' || field.type === 'number'" [id]="field.name"
                            [formControlName]="field.name" class="form-control" />
                        <select *ngIf="field.name === 'pedido' || field.name === 'completo'"
                            [formControlName]="field.name" class="form-select">
                            <option value="" disabled selected>Seleccionar...</option>
                            <option *ngFor="let option of field.name === 'pedido' ? pedidoOptions : completoOptions"
                                [value]="option[field.name]">
                                {{ option[field.name] }}
                            </option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                    ‚ùå Cancelar
                </button>
                <button type="button" class="btn btn-success" (click)="onAddLego()">
                    üíæ Guardar Cambios
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ADD MODAL -->
<div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="addModalLabel">‚ûï Agregar Nueva Pieza de LEGO</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <form [formGroup]="addForm" class="row row-cols-1 row-cols-md-2 g-3">
                    <div class="col" *ngFor="let field of formFields">
                        <label [for]="field.name" class="form-label">{{ field.label }}</label>
                        <input *ngIf="field.type === 'text' || field.type === 'number'" [id]="field.name"
                            [formControlName]="field.name" class="form-control" />
                        <select *ngIf="field.name === 'pedido' || field.name === 'completo'"
                            [formControlName]="field.name" class="form-select">
                            <option value="" disabled selected>Seleccionar...</option>
                            <option *ngFor="let option of field.name === 'pedido' ? pedidoOptions : completoOptions"
                                [value]="option[field.name]">
                                {{ option[field.name] }}
                            </option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                    ‚ùå Cancelar
                </button>
                <button type="button" class="btn btn-success" (click)="OnSubmitLego()">
                    ‚úÖ Guardar Pieza
                </button>
            </div>
        </div>
    </div>
</div>